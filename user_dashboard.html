<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Dashboard</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="global.css"> <!-- Includes modal styles -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">


</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <h2> INFORMATICS VOTING SYSTEM </h2>
    <div class="profile">
        <img id="userPhoto" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Profile">
        <h3 id="userName">Loading...</h3>
        <p id="userRole">Loading...</p>
        <p id="userEmail" style="font-size:12px; opacity:.7;">Loading...</p>
    </div>
    <div class="menu-links">
        <a href="user_dashboard.html" class="active">ğŸ  Dashboard</a>
        <a href="user_candidate.html">ğŸ“ Candidates</a>
        <a href="user_organization.html">ğŸ‘¥ Organizations</a>
        <a href="user_notification.html">ğŸ”” Notifications</a>
        <a href="user_support.html">ğŸ’¬ Help</a>
    </div>
    <div class="sidebar-bottom">
        <a href="user_settings.html"><i class="fas fa-cog"></i> Settings</a>
        <a href="javascript:void(0)" onclick="showLogoutModal()" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
</div>

<!-- Main -->
<div class="main-container">

    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <h2>Welcome, <span id="userNameHeader">User</span>! ğŸ‰</h2>
        <p>Stay updated and participate in elections below.</p>
        <div class="quick-actions">
            <button onclick="window.location.href='user_candidate.html'">ğŸ“ Apply as Candidate</button>
            <button onclick="window.location.href='user_organization.html'">ğŸ‘¥ Browse Organizations</button>
            <button onclick="window.location.href='user_notification.html'">ğŸ”” View Notifications <span id="notifBadge" class="badge">0</span></button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-section">
        <div class="stat-card">
            <i class="fas fa-vote-yea"></i>
            <div>
                <strong id="votesCast">0</strong>
                <span>Votes Cast</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-hourglass-half"></i>
            <div>
                <strong id="pendingElections">0</strong>
                <span>Pending Elections</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-bell"></i>
            <div>
                <strong id="notificationsCount">0</strong>
                <span>Notifications</span>
            </div>
        </div>
    </div>

    <!-- Search & Filter Elections -->
    <div class="search-filter">
        <input type="text" id="searchElection" placeholder="Search elections...">
        <select id="filterStatus">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="completed">Completed</option>
        </select>
    </div>

    <!-- Upcoming Elections Grid -->
    <h3>Upcoming Elections</h3>
    <div class="elections-grid" id="upcomingElections">
        <!-- Cards loaded dynamically -->
    </div>

    <!-- Tips & Updates -->
    <h3>Tips & Updates</h3>
    <div class="tips-container">
        <div class="tip-card">ğŸ’¡ Double-check your votes before submitting!</div>
        <div class="tip-card">ğŸ“¢ Read all candidate manifestos carefully!</div>
        <div class="tip-card">ğŸ“… Voting closes this Friday at 5 PM!</div>
    </div>

    <!-- Recent Activity Feed -->
    <h3>Recent Activity</h3>
    <div class="activity-feed" id="recentActivity">
        <!-- Activity dynamically loaded -->
        <div class="activity-item">You voted in "Student Council Election"</div>
        <div class="activity-item">Candidate John Doe registered</div>
        <div class="activity-item">New election "Sports Club" created</div>
    </div>

    <!-- Floating Help Button -->
     <a href="user_support.html">
    <button id="helpBtn" title="Need Help?">ğŸ’¬</button>
    </a>
<!-- Announcements Ticker -->
<div class="announcements-ticker">
    <marquee behavior="scroll" direction="left">
        ğŸ—³ï¸ Election for Student Council starts tomorrow! &nbsp;&nbsp;&nbsp;
        ğŸ”” Candidate John Doe submitted manifesto. &nbsp;&nbsp;&nbsp;
        ğŸ“… Voting closes this Friday at 5 PM!
    </marquee>
</div>

<!-- Quick Poll -->
<div class="quick-poll">
    <h3>Quick Poll ğŸ—³ï¸</h3>
    <p>Which feature should we improve next?</p>
    <div class="poll-options">
        <button onclick="votePoll('UI')">User Interface</button>
        <button onclick="votePoll('Notifications')">Notifications</button>
        <button onclick="votePoll('Candidates')">Candidate Info</button>
    </div>
</div>

</div>

<!-- Scripts -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBrMco-_L76Prf7dkCOu3QfBTC5DTB315M",
    authDomain: "login-form-d9e8b.firebaseapp.com",
    projectId: "login-form-d9e8b",
    storageBucket: "login-form-d9e8b.appspot.com",
    messagingSenderId: "780297703902",
    appId: "1:780297703902:web:3f1acdbce4faf06aff0d4f"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

/* ---------------- LOAD USER ---------------- */
onAuthStateChanged(auth, async user => {
    if(!user) return window.location.href="user_login.html";
    const snap = await getDoc(doc(db,"users",user.uid));
    const data = snap.exists()? snap.data() : {};
    const firstName = data.first_name || user.displayName || "User";
    const lastName = data.last_name || "";
    const role = (data.role || "USER").toUpperCase();
    const email = data.email || user.email;
    const photoURL = data.photoURL || "https://cdn-icons-png.flaticon.com/512/149/149071.png";

    document.getElementById("userName").textContent = `${firstName} ${lastName}`.trim();
    document.getElementById("userNameHeader").textContent = firstName;
    document.getElementById("userRole").textContent = role;
    document.getElementById("userEmail").textContent = email;
    document.getElementById("userPhoto").src = photoURL;

    // Load upcoming elections
    const container = document.getElementById("upcomingElections");
    const snapElections = await getDocs(collection(db,"elections"));
    snapElections.forEach(docSnap=>{
        const data = docSnap.data();
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML = `<div class="card-title">${data.title} ğŸ—³ï¸</div><p>${data.description}</p><button onclick="voteElection('${docSnap.id}')">Vote Now âœ…</button>`;
        container.appendChild(card);
    });
});

/* ---------------- VOTE MODAL ---------------- */
window.voteElection = (id) => alert(`You voted for election ID: ${id} ğŸ‰`);

/* ---------------- LOGOUT MODAL ---------------- */
const logoutModal = document.getElementById("logoutModal");
const confirmBtn = document.getElementById("confirmLogout");
const cancelBtn = document.getElementById("cancelLogout");
window.showLogoutModal = ()=> logoutModal.classList.add("show");
cancelBtn.addEventListener("click",()=>logoutModal.classList.remove("show"));
logoutModal.addEventListener("click", e=>{ if(e.target===logoutModal) logoutModal.classList.remove("show"); });
confirmBtn.addEventListener("click", ()=>{ 
    logoutModal.classList.remove("show");
    signOut(auth).then(()=> window.location.href="user_login.html");
});

function votePoll(option){
    alert(`Thanks for voting for "${option}"! âœ…`);
}


</script>
</body>
</html>
